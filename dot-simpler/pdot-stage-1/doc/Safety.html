<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="assets/resources/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="assets/resources/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="assets/resources/config.js"></script>
<script type="text/javascript" src="assets/resources/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/themaplelab/dot-public/tree/master/dot-simpler">README</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">Safety</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab82"></a><h1 class="section">Type Soundness</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Coq.Program.Equality</span> <span class="id" title="library">List</span> <span class="id" title="library">String</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Sequences.html#"><span class="id" title="library">Sequences</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Binding.html#"><span class="id" title="library">Binding</span></a> <a class="idref" href="CanonicalForms.html#"><span class="id" title="library">CanonicalForms</span></a> <a class="idref" href="Definitions.html#"><span class="id" title="library">Definitions</span></a> <a class="idref" href="GeneralToTight.html#"><span class="id" title="library">GeneralToTight</span></a> <a class="idref" href="InvertibleTyping.html#"><span class="id" title="library">InvertibleTyping</span></a> <a class="idref" href="Lookup.html#"><span class="id" title="library">Lookup</span></a> <a class="idref" href="Narrowing.html#"><span class="id" title="library">Narrowing</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Reduction.html#"><span class="id" title="library">Reduction</span></a> <a class="idref" href="PreciseTyping.html#"><span class="id" title="library">PreciseTyping</span></a> <a class="idref" href="RecordAndInertTypes.html#"><span class="id" title="library">RecordAndInertTypes</span></a> <a class="idref" href="ReplacementTyping.html#"><span class="id" title="library">ReplacementTyping</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Subenvironments.html#"><span class="id" title="library">Subenvironments</span></a> <a class="idref" href="Substitution.html#"><span class="id" title="library">Substitution</span></a> <a class="idref" href="TightTyping.html#"><span class="id" title="library">TightTyping</span></a> <a class="idref" href="Weakening.html#"><span class="id" title="library">Weakening</span></a>.<br/>

<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab83"></a><h2 class="section">Safety wrt Term Reduction ⟼</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="Safety"><span class="id" title="section">Safety</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab84"></a><h3 class="section">Reasoning about the precise type of objects</h3>

<div class="paragraph"> </div>

 If the rhs of a type declaration is a signleton type <span class="inlinecode"><span class="id" title="var">q.type</span></span> then
    <span class="inlinecode"><span class="id" title="var">q</span></span> is well-typed 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="defs_typing_sngl_rhs"><span class="id" title="lemma">defs_typing_sngl_rhs</span></a> <span class="id" title="var">z</span> <span class="id" title="var">bs</span> <span class="id" title="var">G</span> <span class="id" title="var">ds</span> <span class="id" title="var">T</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#ds"><span class="id" title="variable">ds</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">::</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">{{</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">}}</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">T</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hr</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">D</span>; <span class="id" title="var">inversions</span> <span class="id" title="var">Hr</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">inversions</span> <span class="id" title="var">Hr</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">H5</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">lookup_fields_typ</span></span> notation <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=<span class="id" title="var">bs</span>⇒</span> <span class="inlinecode"><span class="id" title="var">U</span></span> denotes that
    if <span class="inlinecode"><span class="id" title="var">T</span></span> is a recursive type then we can "look up" or "go down" a path
    <span class="inlinecode"><span class="id" title="var">x.bs</span></span> inside of <span class="inlinecode"><span class="id" title="var">T</span></span> yielding a type <span class="inlinecode"><span class="id" title="var">U</span></span>. For example, if
    <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">μ</span>(<span class="id" title="var">x</span>:</span> <span class="inlinecode">{<span class="id" title="var">a</span>:</span> <span class="inlinecode"><span class="id" title="var">μ</span>(<span class="id" title="var">y</span>:</span> <span class="inlinecode">{<span class="id" title="var">b</span>:</span> <span class="inlinecode"><span class="id" title="var">μ</span>(<span class="id" title="var">z</span>:</span> <span class="inlinecode">⊤)})})</span> then
    <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=<span class="id" title="var">b</span>,<span class="id" title="var">a</span>=&gt;⊤</span> 
</div>
<div class="code">
<span class="id" title="keyword">Reserved Notation</span> &quot;x '==&gt;' T '=' bs '=&gt;' U" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">T</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20).<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=<span class="id" title="var">bs</span>⇒</span> <span class="inlinecode"><span class="id" title="var">U</span></span> we will say that looking up the path
    <span class="inlinecode"><span class="id" title="var">x.bs</span></span> in <span class="inlinecode"><span class="id" title="var">T</span></span> yields <span class="inlinecode"><span class="id" title="var">U</span></span>.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a name="lookup_fields_typ"><span class="id" title="inductive">lookup_fields_typ</span></a> : <span class="id" title="axiom">var</span> <span class="id" title="notation">→</span> <a class="idref" href="Definitions.html#typ"><span class="id" title="inductive">typ</span></a> <span class="id" title="notation">→</span> <span class="id" title="inductive">list</span> <a class="idref" href="Definitions.html#trm_label"><span class="id" title="axiom">trm_label</span></a> <span class="id" title="notation">→</span> <a class="idref" href="Definitions.html#typ"><span class="id" title="inductive">typ</span></a> <span class="id" title="notation">→</span> <span class="id" title="keyword">Prop</span> :=<br/>
| <a name="lft_empty"><span class="id" title="constructor">lft_empty</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><span class="id" title="constructor">nil</span><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a><br/>
| <a name="lft_cons"><span class="id" title="constructor">lft_cons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">T</span> <span class="id" title="var">bs</span> <span class="id" title="var">U</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>) <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#a"><span class="id" title="variable">a</span></a><span class="id" title="notation">::</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a><br/>
<br/>
<span class="id" title="keyword">where</span> <a name="2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">&quot;</span></a>x '==&gt;' T '=' bs '=&gt;' U" := (<a class="idref" href="Safety.html#lookup_fields_typ"><span class="id" title="inductive">lookup_fields_typ</span></a> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">bs</span> <span class="id" title="var">U</span>).<br/>

<br/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Safety.html#lookup_fields_typ"><span class="id" title="inductive">lookup_fields_typ</span></a> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab85"></a><h4 class="section">Properties of <span class="inlinecode"><span class="id" title="var">lookup_fields_typ</span></span></h4>

<div class="paragraph"> </div>

 Looking up a path inside of an inert type yields an inert type 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lft_inert"><span class="id" title="lemma">lft_inert</span></a> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">bs</span> <span class="id" title="var">U</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> (<a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hl</span>. <span class="id" title="var">gen</span> <span class="id" title="var">x</span> <span class="id" title="var">U</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">bs</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hl</span>; <span class="id" title="var">inversions</span> <span class="id" title="var">Hl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHbs</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H3</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="RecordAndInertTypes.html#inert_record_has"><span class="id" title="lemma">inert_record_has</span></a> <span class="id" title="var">_</span> <span class="id" title="var">IHbs</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hin</span> | [? [=]]]. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">lookup_fields_typ</span></span> relation is functional. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">x</span> <span class="id" title="var">S</span> <span class="id" title="var">bs</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">=</span> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hl1</span>. <span class="id" title="var">gen</span> <span class="id" title="var">U</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Hl1</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hl2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHl1</span> <span class="id" title="var">Hi</span> <span class="id" title="var">_</span> <span class="id" title="var">H4</span>) <span class="id" title="keyword">as</span> [= -&gt;].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_inert"><span class="id" title="lemma">lft_inert</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hl1</span>). <span class="id" title="var">inversions</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="RecordAndInertTypes.html#unique_rcd_trm"><span class="id" title="lemma">unique_rcd_trm</span></a>. <span class="id" title="tactic">apply</span>× <a class="idref" href="RecordAndInertTypes.html#open_record_type_p"><span class="id" title="lemma">open_record_type_p</span></a>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If looking up a path in <span class="inlinecode"><span class="id" title="var">T</span></span> yields a function type then we cannot
    look up a longer path in <span class="inlinecode"><span class="id" title="var">T</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lft_typ_all_inv"><span class="id" title="lemma">lft_typ_all_inv</span></a> <span class="id" title="var">x</span> <span class="id" title="var">S</span> <span class="id" title="var">bs</span> <span class="id" title="var">cs</span> <span class="id" title="var">V</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">∀(</span></a><a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a><a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">)</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a> <span class="id" title="notation">=</span> <span class="id" title="constructor">nil</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">x</span> <span class="id" title="var">S</span> <span class="id" title="var">bs</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> <span class="id" title="var">V</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">cs</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">app_comm_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHcs</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">H3</span>) <span class="id" title="keyword">as</span> →.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">H3</span>) <span class="id" title="keyword">as</span> [= &lt;-].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If looking up a path in <span class="inlinecode"><span class="id" title="var">T</span></span> yields a singleton type then we cannot
    look up a longer path in <span class="inlinecode"><span class="id" title="var">T</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lft_typ_sngl_inv"><span class="id" title="lemma">lft_typ_sngl_inv</span></a> <span class="id" title="var">x</span> <span class="id" title="var">S</span> <span class="id" title="var">bs</span> <span class="id" title="var">p</span> <span class="id" title="var">cs</span> <span class="id" title="var">V</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">{{</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">}}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a> <span class="id" title="notation">=</span> <span class="id" title="constructor">nil</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">x</span> <span class="id" title="var">S</span> <span class="id" title="var">bs</span> <span class="id" title="var">p</span> <span class="id" title="var">V</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">cs</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">app_comm_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHcs</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">H3</span>) <span class="id" title="keyword">as</span> →.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">H3</span>) <span class="id" title="keyword">as</span> [= &lt;-].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If the definitions <span class="inlinecode"><span class="id" title="var">ds</span></span> that correspond to a path <span class="inlinecode"><span class="id" title="var">p</span></span> (here, <span class="inlinecode"><span class="id" title="var">z.bs</span></span>)
    have a type <span class="inlinecode"><span class="id" title="var">T</span>ᵖ</span>, and looking up the path <span class="inlinecode"><span class="id" title="var">x.cs</span></span> for some <span class="inlinecode"><span class="id" title="var">x</span></span>
    in <span class="inlinecode"><span class="id" title="var">T</span>ᵖ</span> yields a type <span class="inlinecode"><span class="id" title="var">μ</span>(<span class="id" title="var">U</span>)</span> then nested in <span class="inlinecode"><span class="id" title="var">ds</span></span> are some definitions
    <span class="inlinecode"><span class="id" title="var">ds'</span></span> such that under the path <span class="inlinecode"><span class="id" title="var">p.cs</span></span>, <span class="inlinecode"><span class="id" title="var">ds'</span></span> can be typed with <span class="inlinecode"><span class="id" title="var">U</span></span><sup>p.cs</sup>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lfs_defs_typing"><span class="id" title="lemma">lfs_defs_typing</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">cs</span> <span class="id" title="var">z</span> <span class="id" title="var">bs</span> <span class="id" title="var">G</span> <span class="id" title="var">ds</span> <span class="id" title="var">T</span> <span class="id" title="var">S</span> <span class="id" title="var">U</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#ds"><span class="id" title="variable">ds</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">::</span></a> <a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>) <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">ds'</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">(</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">);</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#ds'"><span class="id" title="variable">ds'</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">::</span></a> <a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) (<a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>)) <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">cs</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span>×. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> [= -&gt;]. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">app_comm_cons</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHcs</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">H3</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">ds'</span> <span class="id" title="var">Hds'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Binding.html#record_has_ty_defs"><span class="id" title="lemma">record_has_ty_defs</span></a> <span class="id" title="var">Hds'</span> <span class="id" title="var">H5</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> [<span class="id" title="var">Hdh</span> <span class="id" title="var">Hd</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hd</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Suppose the declaration <span class="inlinecode"><span class="id" title="var">d</span></span> corresponding to a path <span class="inlinecode"><span class="id" title="var">z.bs</span></span>
    has type <span class="inlinecode">{<span class="id" title="var">b</span>:</span> <span class="inlinecode"><span class="id" title="var">V</span>}</span>, and that <span class="inlinecode"><span class="id" title="var">V</span>=...∧</span> <span class="inlinecode">{<span class="id" title="var">a</span>:</span> <span class="inlinecode"><span class="id" title="var">q.type</span>}</span> <span class="inlinecode">∧...</span>.
    Then <span class="inlinecode"><span class="id" title="var">q</span></span> is well-typed.
    
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="def_typing_rhs"><span class="id" title="lemma">def_typing_rhs</span></a> <span class="id" title="var">z</span> <span class="id" title="var">bs</span> <span class="id" title="var">G</span> <span class="id" title="var">d</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span> <span class="id" title="var">U</span> <span class="id" title="var">S</span> <span class="id" title="var">cs</span> <span class="id" title="var">T</span> <span class="id" title="var">b</span> <span class="id" title="var">V</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a><a class="idref" href="Definitions.html#ae7a57a11402d7c5d6d3a8914fe4ced3"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Definitions.html#ae7a57a11402d7c5d6d3a8914fe4ced3"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#ae7a57a11402d7c5d6d3a8914fe4ced3"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="Definitions.html#ae7a57a11402d7c5d6d3a8914fe4ced3"><span class="id" title="notation">:</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>) <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a><span class="id" title="notation">::</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) (<a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a><span class="id" title="notation">::</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>)) <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">{{</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">}}</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">W</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#W"><span class="id" title="variable">W</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hrd</span> <span class="id" title="var">Hl2</span> <span class="id" title="var">Hr</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "def_all"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#lft_cons"><span class="id" title="constructor">lft_cons</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_typ_all_inv"><span class="id" title="lemma">lft_typ_all_inv</span></a> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> →.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> [=].<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "def_new"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Definitions.html#ty_def_new"><span class="id" title="constructor">ty_def_new</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="constructor">eq_refl</span> <span class="id" title="var">H6</span> <span class="id" title="var">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">z</span> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="var">S</span> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><span class="id" title="var">b</span><span class="id" title="notation">::</span><span class="id" title="var">bs</span><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <span class="id" title="var">T0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hl1'</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#lft_cons"><span class="id" title="constructor">lft_cons</span></a>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lfs_defs_typing"><span class="id" title="lemma">lfs_defs_typing</span></a> <span class="id" title="var">_</span> <span class="id" title="var">H7</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1'</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">ds'</span> <span class="id" title="var">Hds'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Binding.html#record_has_ty_defs"><span class="id" title="lemma">record_has_ty_defs</span></a> <span class="id" title="var">Hds'</span> <span class="id" title="var">Hr</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> [<span class="id" title="var">Hdh</span> <span class="id" title="var">Hd</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hd</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "def_path"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#lft_cons"><span class="id" title="constructor">lft_cons</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_typ_sngl_inv"><span class="id" title="lemma">lft_typ_sngl_inv</span></a> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> →.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#lft_unique"><span class="id" title="lemma">lft_unique</span></a> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hl2</span>) <span class="id" title="keyword">as</span> [=].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The same applies to the case where we type multiple declarations that contain
    <span class="inlinecode">{<span class="id" title="var">b</span>:</span> <span class="inlinecode"><span class="id" title="var">V</span>}</span> as a record. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="defs_typing_rhs"><span class="id" title="lemma">defs_typing_rhs</span></a> <span class="id" title="var">z</span> <span class="id" title="var">bs</span> <span class="id" title="var">G</span> <span class="id" title="var">ds</span> <span class="id" title="var">T</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span> <span class="id" title="var">U</span> <span class="id" title="var">S</span> <span class="id" title="var">cs</span> <span class="id" title="var">T'</span> <span class="id" title="var">b</span> <span class="id" title="var">V</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#ds"><span class="id" title="variable">ds</span></a> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">::</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>) <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#S"><span class="id" title="variable">S</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a><span class="id" title="notation">::</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#z"><span class="id" title="variable">z</span></a>) (<a class="idref" href="Safety.html#cs"><span class="id" title="variable">cs</span></a><span class="id" title="notation">++</span><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a><span class="id" title="notation">::</span><a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a>)) <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">{{</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#2e12ae37c5a5c7396a13d7170e0de451"><span class="id" title="notation">}}</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">V</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <a class="idref" href="Safety.html#q"><span class="id" title="variable">q</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Hin</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">Hr1</span> <span class="id" title="var">Hr2</span> <span class="id" title="var">Hl2</span> <span class="id" title="var">Hr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">S</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span> <span class="id" title="var">U</span> <span class="id" title="var">cs</span> <span class="id" title="var">T'</span> <span class="id" title="var">b</span> <span class="id" title="var">V</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hds</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hin</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hl1</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hl2</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Hr1</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">inversions</span> <span class="id" title="var">Hr2</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#def_typing_rhs"><span class="id" title="lemma">def_typing_rhs</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHds</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hl1</span> <span class="id" title="var">_</span> <span class="id" title="var">Hl2</span> <span class="id" title="var">Hr</span> <span class="id" title="var">_</span> <span class="id" title="var">Hr1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hr2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHHds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#def_typing_rhs"><span class="id" title="lemma">def_typing_rhs</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Looking up a path inside of a variable <span class="inlinecode"><span class="id" title="var">x</span></span>'s environment type,
    given that we can type the path <span class="inlinecode"><span class="id" title="var">x.bs</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="pf_sngl_to_lft"><span class="id" title="lemma">pf_sngl_to_lft</span></a> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">bs</span> <span class="id" title="var">W</span> <span class="id" title="var">V</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> (<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="notation">~</span> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a>) <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="notation">~</span> <span class="id" title="notation">(</span><a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a><span class="id" title="notation">)</span> <a class="idref" href="PreciseFlow.html#27d10efae8295170a08832205c915493"><span class="id" title="notation">⊢!</span></a> <a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a> <a class="idref" href="PreciseFlow.html#27d10efae8295170a08832205c915493"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#W"><span class="id" title="variable">W</span></a> <a class="idref" href="PreciseFlow.html#27d10efae8295170a08832205c915493"><span class="id" title="notation">⪼</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a> <span class="id" title="notation">=</span> <span class="id" title="constructor">nil</span> <span class="id" title="notation">∨</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">bs'</span> <span class="id" title="var">bs''</span> <span class="id" title="var">U</span> <span class="id" title="var">V</span><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a> <span class="id" title="notation">=</span> <a class="idref" href="Safety.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Safety.html#bs'"><span class="id" title="variable">bs'</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#bs"><span class="id" title="variable">bs</span></a> <span class="id" title="notation">=</span> <a class="idref" href="Safety.html#bs''"><span class="id" title="variable">bs''</span></a> <span class="id" title="notation">++</span> <a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <span class="id" title="notation">::</span> <span class="id" title="constructor">nil</span> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">(</span></a><a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">)</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">=</span></a><a class="idref" href="Safety.html#bs'"><span class="id" title="variable">bs'</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">(</span></a><a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a><a class="idref" href="Safety.html#2c94547ea97c5c3e346ee66431009735"><span class="id" title="notation">)</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ"><span class="id" title="definition">open_typ</span></a> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#record_has"><span class="id" title="inductive">record_has</span></a> (<a class="idref" href="Definitions.html#open_typ_p"><span class="id" title="definition">open_typ_p</span></a> (<a class="idref" href="Definitions.html#p_sel"><span class="id" title="constructor">p_sel</span></a> (<a class="idref" href="Definitions.html#avar_f"><span class="id" title="constructor">avar_f</span></a> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="Safety.html#bs'"><span class="id" title="variable">bs'</span></a>) <a class="idref" href="Safety.html#U"><span class="id" title="variable">U</span></a>) <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">{</span></a><a class="idref" href="Safety.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">⦂</span></a> <a class="idref" href="Safety.html#W"><span class="id" title="variable">W</span></a><a class="idref" href="Definitions.html#18cbe8108c7275adbcbe2d488cc0d64e"><span class="id" title="notation">}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hp</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">simpl_dot</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hi</span> <span class="id" title="constructor">JMeq_refl</span> <span class="id" title="constructor">eq_refl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [-&gt; | [<span class="id" title="var">b</span> [<span class="id" title="var">c</span> [<span class="id" title="var">bs'</span> [<span class="id" title="var">bs''</span> [<span class="id" title="var">S</span> [<span class="id" title="var">V</span> [-&gt; [<span class="id" title="var">Hl</span> [<span class="id" title="var">Hl2</span> [<span class="id" title="var">Hr1</span> <span class="id" title="var">Hr2</span>]]]]]]]]]]].<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "pf_bind"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="PreciseFlow.html#pf_binds"><span class="id" title="lemma">pf_binds</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hp</span>) <span class="id" title="keyword">as</span> -&gt;%<span class="id" title="lemma">binds_push_eq_inv</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Binding.html#open_var_typ_eq"><span class="id" title="lemma">open_var_typ_eq</span></a>. <span class="id" title="tactic">eapply</span> <a class="idref" href="PreciseFlow.html#pf_record_has_T"><span class="id" title="lemma">pf_record_has_T</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="PreciseFlow.html#pf_record_has_T"><span class="id" title="lemma">pf_record_has_T</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "pf_fld"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="PreciseFlow.html#pf_bnd_T2"><span class="id" title="lemma">pf_bnd_T2</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hp</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">W</span> -&gt;].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="var">a</span> <span class="id" title="notation">::</span> <span class="id" title="var">bs''</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hl</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span>× <a class="idref" href="PreciseFlow.html#pf_record_has_T"><span class="id" title="lemma">pf_record_has_T</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Every value of type <span class="inlinecode"><span class="id" title="var">T</span></span> has a precise type that is inert, well-formed,
    and is a subtype of <span class="inlinecode"><span class="id" title="var">T</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="val_typing"><span class="id" title="lemma">val_typing</span></a> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span> <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Safety.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="notation">#</span> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">T'</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="PreciseFlow.html#9352b36e773c80f96d88a9284b3018d7"><span class="id" title="notation">⊢!</span></a><a class="idref" href="PreciseFlow.html#9352b36e773c80f96d88a9284b3018d7"><span class="id" title="notation">v</span></a> <a class="idref" href="Safety.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="PreciseFlow.html#9352b36e773c80f96d88a9284b3018d7"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#d77433d9a5f06bee50380b6ca9a3f271"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a> <a class="idref" href="Definitions.html#d77433d9a5f06bee50380b6ca9a3f271"><span class="id" title="notation">&lt;:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> (<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="notation">~</span> <a class="idref" href="Safety.html#T'"><span class="id" title="variable">T'</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hv</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hv</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">∃</span> (<a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">∀(</span></a><span class="id" title="var">T</span><a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">)</span></a> <span class="id" title="var">U</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>×. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">introv</span> <span class="id" title="var">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">binds</span> <span class="id" title="var">x</span> (<a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">∀(</span></a><span class="id" title="var">T</span><a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">)</span></a> <span class="id" title="var">U</span>) (<span class="id" title="var">G</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">x</span> <span class="id" title="notation">~</span> <a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">∀(</span></a><span class="id" title="var">T</span><a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">)</span></a> <span class="id" title="var">U</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">Hb</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="PreciseFlow.html#pf_bind"><span class="id" title="constructor">pf_bind</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hb</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">bs</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">b</span> <span class="id" title="var">bs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="PreciseFlow.html#pf_binds"><span class="id" title="lemma">pf_binds</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">binds_push_eq_inv</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp</span> <span class="id" title="keyword">as</span> [=].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="PreciseFlow.html#pf_sngl"><span class="id" title="lemma">pf_sngl</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp</span> <span class="id" title="keyword">as</span> [? [? [=]%<a class="idref" href="PreciseFlow.html#pf_binds"><span class="id" title="lemma">pf_binds</span></a>%<span class="id" title="lemma">binds_push_eq_inv</span>]]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">∃</span> (<a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <span class="id" title="var">T</span>). <span class="id" title="tactic">assert</span> (<a class="idref" href="Definitions.html#inert_typ"><span class="id" title="inductive">inert_typ</span></a> (<a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <span class="id" title="var">T</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">Hin</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="PreciseFlow.html#ty_new_intro_p"><span class="id" title="constructor">ty_new_intro_p</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span>× <a class="idref" href="PreciseFlow.html#pfv_inert"><span class="id" title="lemma">pfv_inert</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>×. <span class="id" title="var">pick_fresh</span> <span class="id" title="var">z</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">z</span> <span class="id" title="notation">\</span><span class="id" title="notation">notin</span> <span class="id" title="var">L</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hz</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>). <span class="id" title="tactic">assert</span> (<span class="id" title="var">z</span> <span class="id" title="notation">#</span> <span class="id" title="var">G</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hz'</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>×. <span class="id" title="var">introv</span> <span class="id" title="var">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="notation">∃</span> <span class="id" title="var">W</span><span class="id" title="notation">,</span> <span class="id" title="var">G</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">x</span> <span class="id" title="notation">~</span> <span class="id" title="notation">(</span><a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <span class="id" title="var">T</span><span class="id" title="notation">)</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <span class="id" title="var">q</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#W"><span class="id" title="variable">W</span></a>) <span class="id" title="keyword">as</span> [<span class="id" title="var">W</span> <span class="id" title="var">Hq</span>]. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> (<span class="id" title="var">G</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">x</span> <span class="id" title="notation">~</span> <a class="idref" href="Definitions.html#57e8a3f1aebb1c6069654ec2f0cd7a19"><span class="id" title="notation">μ</span></a> <span class="id" title="var">T</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">Hi'</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#pf_sngl_to_lft"><span class="id" title="lemma">pf_sngl_to_lft</span></a> <span class="id" title="var">Hi'</span> <span class="id" title="var">Hp</span>) <span class="id" title="keyword">as</span> [-&gt; | [<span class="id" title="var">b</span> [<span class="id" title="var">c</span> [<span class="id" title="var">bs'</span> [<span class="id" title="var">bs''</span> [<span class="id" title="var">U</span> [<span class="id" title="var">V</span> [-&gt; [<span class="id" title="var">Hl1</span> [<span class="id" title="var">Hl2</span> [<span class="id" title="var">Hr1</span> <span class="id" title="var">Hr2</span>]]]]]]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="PreciseFlow.html#pf_binds"><span class="id" title="lemma">pf_binds</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp</span> <span class="id" title="keyword">as</span> [=]%<span class="id" title="lemma">binds_push_eq_inv</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">x</span><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <span class="id" title="constructor">nil</span><a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">;</span></a> <span class="id" title="var">G</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">x</span> <span class="id" title="notation">~</span> <a class="idref" href="Definitions.html#open_typ"><span class="id" title="definition">open_typ</span></a> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#open_defs"><span class="id" title="definition">open_defs</span></a> <span class="id" title="var">x</span> <span class="id" title="var">ds</span> <a class="idref" href="Definitions.html#ed2865d5b6635aaa6d875cc0fd7c034b"><span class="id" title="notation">::</span></a> <a class="idref" href="Definitions.html#open_typ"><span class="id" title="definition">open_typ</span></a> <span class="id" title="var">x</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">Hdx</span>%<a class="idref" href="Binding.html#open_env_last_defs"><span class="id" title="lemma">open_env_last_defs</span></a>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Substitution.html#rename_defs"><span class="id" title="lemma">rename_defs</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span>:=<span class="id" title="var">z</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">bs''</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">bs'h</span> <span class="id" title="var">bs't</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="var">inversions</span> <span class="id" title="var">Hl1</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#defs_typing_sngl_rhs"><span class="id" title="lemma">defs_typing_sngl_rhs</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hdx</span>. <span class="id" title="tactic">rewrite</span>× <a class="idref" href="Binding.html#open_var_typ_eq"><span class="id" title="lemma">open_var_typ_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">app_comm_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl1</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">Hl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#defs_typing_rhs"><span class="id" title="lemma">defs_typing_rhs</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hdx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Binding.html#open_var_typ_eq"><span class="id" title="lemma">open_var_typ_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hr1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="GeneralToTight.html#pt3_exists"><span class="id" title="lemma">pt3_exists</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hq</span> <span class="id" title="keyword">as</span> [? <span class="id" title="var">Hq'</span>%<a class="idref" href="PreciseTyping.html#pt2_exists"><span class="id" title="lemma">pt2_exists</span></a>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHv</span> <span class="id" title="var">_</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="constructor">eq_refl</span> <span class="id" title="var">Hx</span>). <span class="id" title="var">destruct_all</span>. <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>×.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Helper tactics for proving Preservation 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lookup_eq</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">Hl1</span>: ?<span class="id" title="var">s</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟦</span></a> <span class="id" title="var">_</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⤳*</span></a> <a class="idref" href="Definitions.html#defv"><span class="id" title="constructor">defv</span></a> ?<span class="id" title="var">t1</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟧</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hl2</span>: ?<span class="id" title="var">s</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟦</span></a> <span class="id" title="var">_</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⤳*</span></a> <a class="idref" href="Definitions.html#defv"><span class="id" title="constructor">defv</span></a> ?<span class="id" title="var">t2</span> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟧</span></a> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="Lookup.html#lookup_func"><span class="id" title="lemma">lookup_func</span></a> <span class="id" title="var">Hl1</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">Hl2</span>; <span class="id" title="var">inversions</span> <span class="id" title="var">Hl2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">invert_red</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">Hr</span>: <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="var">_</span><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="var">_</span><span class="id" title="notation">)</span> |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="var">inversions</span> <span class="id" title="var">Hr</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">solve_IH</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">IH</span>: <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <span class="id" title="var">_</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <span class="id" title="var">_</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <span class="id" title="var">_</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">t'</span>, <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="var">_</span><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="var">_</span><span class="id" title="notation">)</span> <span class="id" title="notation">→</span> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Wt</span>: <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span>: <a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Wf</span>: <a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hr</span>: <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="var">_</span><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><span class="id" title="var">_</span><span class="id" title="notation">,</span> ?<span class="id" title="var">t'</span><span class="id" title="notation">)</span> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> <span class="id" title="var">Wt</span> <span class="id" title="var">In</span> <span class="id" title="var">Wf</span> <span class="id" title="var">t'</span> <span class="id" title="var">Hr</span>); <span class="id" title="var">destruct_all</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">Hi</span>: <span class="id" title="var">_</span> <span class="id" title="notation">&amp;</span> ?<span class="id" title="var">G'</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">G'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">solve_let</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">invert_red</span>; <span class="id" title="var">solve_IH</span>; <span class="id" title="var">fresh_constructor</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">apply</span>× <a class="idref" href="Weakening.html#weaken_rules"><span class="id" title="lemma">weaken_rules</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab86"></a><h4 class="section">Preservation (Lemma 5.4)</h4>
 If a term <span class="inlinecode"><span class="id" title="var">γ</span>|<span class="id" title="var">t</span></span> has type <span class="inlinecode"><span class="id" title="var">T</span></span> and reduces to <span class="inlinecode"><span class="id" title="var">γ'</span>|<span class="id" title="var">t'</span></span> then the latter has
    the same type <span class="inlinecode"><span class="id" title="var">T</span></span> under an extended environment that is inert, well-typed,
    and well-formed. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="preservation"><span class="id" title="lemma">preservation</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">G</span> <span class="id" title="var">γ</span> <span class="id" title="var">t</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <span class="id" title="var">G'</span><span class="id" title="notation">,</span> <a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G'"><span class="id" title="variable">G'</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> (<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#G'"><span class="id" title="variable">G'</span></a>) <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#G'"><span class="id" title="variable">G'</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Safety.html#G'"><span class="id" title="variable">G'</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hred</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">gen</span> <span class="id" title="var">t'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">invert_red</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "ty_all_elim"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Hp</span>: <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">∀(</span></a><span class="id" title="var">_</span><a class="idref" href="Definitions.html#5602fefe5ae9ac7607d0a75368b09df0"><span class="id" title="notation">)</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="CanonicalForms.html#canonical_forms_fun"><span class="id" title="lemma">canonical_forms_fun</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hp</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">L</span> [<span class="id" title="var">T'</span> [<span class="id" title="var">t</span> [<span class="id" title="var">Hl</span> [<span class="id" title="var">Hsub</span> <span class="id" title="var">Hty</span>]]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert_red</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (@<span class="id" title="axiom">empty</span> <a class="idref" href="Definitions.html#typ"><span class="id" title="inductive">typ</span></a>). <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">concat_empty_r</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pick_fresh</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">y</span> <span class="id" title="notation">\</span><span class="id" title="notation">notin</span> <span class="id" title="var">L</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">FrL</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hty</span> <span class="id" title="var">y</span> <span class="id" title="var">FrL</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Substitution.html#subst_var_path"><span class="id" title="lemma">subst_var_path</span></a>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "ty_let"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">solve_let</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">SCase</span> "[t = (let x = v in u)] where v is a value"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">invert_red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Hn</span>: ?<span class="id" title="var">x</span> <span class="id" title="notation">#</span> ?<span class="id" title="var">s</span> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Binding.html#well_typed_notin_dom"><span class="id" title="lemma">well_typed_notin_dom</span></a> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hn</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hng</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#val_typing"><span class="id" title="lemma">val_typing</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Ht</span> <span class="id" title="var">Hng</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">V</span> [<span class="id" title="var">Hv</span> [<span class="id" title="var">Hs</span> [<span class="id" title="var">Hin</span> <span class="id" title="var">Hwf'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">x</span> <span class="id" title="notation">~</span> <span class="id" title="var">V</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">concat_empty_l</span>. <span class="id" title="tactic">constructor</span>~.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">constructor</span>~. <span class="id" title="tactic">apply</span> (<a class="idref" href="PreciseFlow.html#precise_to_general_v"><span class="id" title="lemma">precise_to_general_v</span></a> <span class="id" title="var">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">rewrite</span> <a class="idref" href="Binding.html#open_var_trm_eq"><span class="id" title="lemma">open_var_trm_eq</span></a>. <span class="id" title="tactic">eapply</span> <a class="idref" href="Substitution.html#subst_fresh_var_path"><span class="id" title="lemma">subst_fresh_var_path</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">L</span>:=<span class="id" title="var">L</span> <span class="id" title="notation">\</span><span class="id" title="notation">u</span> <span class="id" title="axiom">dom</span> <span class="id" title="var">G</span> <span class="id" title="notation">\</span><span class="id" title="notation">u</span> <span class="id" title="notation">\{</span><span class="id" title="var">x</span><span class="id" title="notation">}</span>). <span class="id" title="tactic">apply</span>× <span class="id" title="constructor">ok_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>× <a class="idref" href="Weakening.html#weaken_rules"><span class="id" title="lemma">weaken_rules</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Definitions.html#ty_sub"><span class="id" title="constructor">ty_sub</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">T</span>:=<span class="id" title="var">V</span>); <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span>× <a class="idref" href="Weakening.html#weaken_subtyp"><span class="id" title="lemma">weaken_subtyp</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">SCase</span> "[t = (let x = p in u)] where a is p variable"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">invert_red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (@<span class="id" title="axiom">empty</span> <a class="idref" href="Definitions.html#typ"><span class="id" title="inductive">typ</span></a>). <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">concat_empty_r</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span>× <a class="idref" href="Substitution.html#subst_fresh_var_path"><span class="id" title="lemma">subst_fresh_var_path</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "ty_sub"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">solve_IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Hs</span>: <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#d77433d9a5f06bee50380b6ca9a3f271"><span class="id" title="notation">⊢</span></a> <span class="id" title="var">_</span> <a class="idref" href="Definitions.html#d77433d9a5f06bee50380b6ca9a3f271"><span class="id" title="notation">&lt;:</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hg</span>: <span class="id" title="var">_</span> <span class="id" title="notation">&amp;</span> ?<span class="id" title="var">G'</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <span class="id" title="var">_</span><a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Weakening.html#weaken_subtyp"><span class="id" title="lemma">weaken_subtyp</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">G2</span>:=<span class="id" title="var">G'</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">Hs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab87"></a><h4 class="section">Progress (Lemma 5.3)</h4>
 Any well-typed term is either in normal form (i.e. a path or value) or can
    take a reduction step. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="progress"><span class="id" title="lemma">progress</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">G</span> <span class="id" title="var">γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Reduction.html#norm_form"><span class="id" title="inductive">norm_form</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="notation">∨</span> <span class="id" title="notation">∃</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t'</span><span class="id" title="notation">,</span> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "ty_all_elim"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="CanonicalForms.html#canonical_forms_fun"><span class="id" title="lemma">canonical_forms_fun</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Ht1</span>). <span class="id" title="var">destruct_all</span>. <span class="id" title="tactic">right</span>×.<br/>
&nbsp;&nbsp;- <span class="id" title="var">Case</span> "ty_let"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">pick_fresh</span> <span class="id" title="var">z</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="var">γ</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">z</span> <span class="id" title="notation">~</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHt</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hn</span> | [<span class="id" title="var">γ'</span> [<span class="id" title="var">t'</span> <span class="id" title="var">Hr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hn</span>. } <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHt</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hn</span> | [<span class="id" title="var">γ'</span> [<span class="id" title="var">t'</span> <span class="id" title="var">Hr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hn</span>. } <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab88"></a><h3 class="section">Safety</h3>

<div class="paragraph"> </div>

 If a term <span class="inlinecode"><span class="id" title="var">γ</span>|<span class="id" title="var">t</span></span> has type <span class="inlinecode"><span class="id" title="var">T</span></span> and reduces in a finite number of steps
    to <span class="inlinecode"><span class="id" title="var">γ'</span>|<span class="id" title="var">t'</span></span> then the latter is either in normal form and has type <span class="inlinecode"><span class="id" title="var">T</span></span>,
    or it can take a further step to a term <span class="inlinecode"><span class="id" title="var">γ''</span>|<span class="id" title="var">t''</span></span>, where <span class="inlinecode"><span class="id" title="var">t''</span></span> also
    has type <span class="inlinecode"><span class="id" title="var">T</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="safety_helper"><span class="id" title="lemma">safety_helper</span></a> <span class="id" title="var">G</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">γ1</span> <span class="id" title="var">γ2</span> <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t1"><span class="id" title="variable">t1</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#93b6893d965d0ff85791b6f6272b83f6"><span class="id" title="variable">γ1</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#93b6893d965d0ff85791b6f6272b83f6"><span class="id" title="variable">γ1</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t1"><span class="id" title="variable">t1</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#4e97cf452882dc3f98e0131fef8d7935"><span class="id" title="notation">⟼*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#f5211f18560f264a76f44a118d98e2f1"><span class="id" title="variable">γ2</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t2"><span class="id" title="variable">t2</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">∃</span> <span class="id" title="var">γ3</span> <span class="id" title="var">t3</span> <span class="id" title="var">G3</span><span class="id" title="notation">,</span> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#f5211f18560f264a76f44a118d98e2f1"><span class="id" title="variable">γ2</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t2"><span class="id" title="variable">t2</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#9c86958633127633391159bbd56dbf11"><span class="id" title="variable">γ3</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t3"><span class="id" title="variable">t3</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G3"><span class="id" title="variable">G3</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t3"><span class="id" title="variable">t3</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#9c86958633127633391159bbd56dbf11"><span class="id" title="variable">γ3</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G3"><span class="id" title="variable">G3</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G3"><span class="id" title="variable">G3</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G3"><span class="id" title="variable">G3</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∨</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">∃</span> <span class="id" title="var">G2</span><span class="id" title="notation">,</span> <a class="idref" href="Reduction.html#norm_form"><span class="id" title="inductive">norm_form</span></a> <a class="idref" href="Safety.html#t2"><span class="id" title="variable">t2</span></a> <span class="id" title="notation">∧</span> <a class="idref" href="Safety.html#G2"><span class="id" title="variable">G2</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t2"><span class="id" title="variable">t2</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#f5211f18560f264a76f44a118d98e2f1"><span class="id" title="variable">γ2</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G2"><span class="id" title="variable">G2</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G2"><span class="id" title="variable">G2</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G2"><span class="id" title="variable">G2</span></a><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hr</span>. <span class="id" title="var">gen</span> <span class="id" title="var">G</span> <span class="id" title="var">T</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hr</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span>; <span class="id" title="var">introv</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#progress"><span class="id" title="lemma">progress</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Ht</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hn</span> | [<span class="id" title="var">γ'</span> [<span class="id" title="var">t'</span> <span class="id" title="var">Hr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">G</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#preservation"><span class="id" title="lemma">preservation</span></a> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Ht</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">G'</span> [<span class="id" title="var">Hi'</span> [<span class="id" title="var">Hwf'</span> [<span class="id" title="var">Hwt'</span> <span class="id" title="var">Ht'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t'</span> (<span class="id" title="var">G</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">G'</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>×. <span class="id" title="tactic">apply</span>× <a class="idref" href="RecordAndInertTypes.html#inert_concat"><span class="id" title="lemma">inert_concat</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">γ12</span> <span class="id" title="var">t12</span>]. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHr</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="constructor">eq_refl</span> <span class="id" title="constructor">eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#preservation"><span class="id" title="lemma">preservation</span></a> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">H</span> <span class="id" title="var">Ht</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">G'</span> [<span class="id" title="var">Hi'</span> [<span class="id" title="var">Hwf'</span> [<span class="id" title="var">Hwt'</span> <span class="id" title="var">Ht'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHr</span> <span class="id" title="var">_</span> (<a class="idref" href="RecordAndInertTypes.html#inert_concat"><span class="id" title="lemma">inert_concat</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hi'</span> (<a class="idref" href="Binding.html#well_typed_to_ok_G"><span class="id" title="lemma">well_typed_to_ok_G</span></a> <span class="id" title="var">Hwt'</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="diverges"><span class="id" title="definition">diverges</span></a> := <a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> <a class="idref" href="Reduction.html#red"><span class="id" title="inductive">red</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="cyclic_path"><span class="id" title="definition">cyclic_path</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">p</span> := <a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> (<a class="idref" href="Lookup.html#lookup_step"><span class="id" title="inductive">lookup_step</span></a> <a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a>) (<a class="idref" href="Definitions.html#defp"><span class="id" title="constructor">defp</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab89"></a><h4 class="section">Type Soundness (Theorem 5.1)</h4>
 Reducing any well-typed program (i.e. term that can be typed in an empty context)
    results either
<ul class="doclist">
<li> in a normal form (i.e. path or value) in a finite number of steps,

</li>
<li> in an infinite reduction sequence. 
</li>
</ul>

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="safety"><span class="id" title="lemma">safety</span></a> <span class="id" title="var">t</span> <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;<span class="id" title="axiom">empty</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;<a class="idref" href="Safety.html#diverges"><span class="id" title="definition">diverges</span></a> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∨</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">∃</span> <span class="id" title="var">γ</span> <span class="id" title="var">u</span> <span class="id" title="var">G</span><span class="id" title="notation">,</span> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#4e97cf452882dc3f98e0131fef8d7935"><span class="id" title="notation">⟼*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#u"><span class="id" title="variable">u</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Reduction.html#norm_form"><span class="id" title="inductive">norm_form</span></a> <a class="idref" href="Safety.html#u"><span class="id" title="variable">u</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#u"><span class="id" title="variable">u</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Sequences.html#infseq_or_finseq"><span class="id" title="lemma">infseq_or_finseq</span></a> <a class="idref" href="Reduction.html#red"><span class="id" title="inductive">red</span></a> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <span class="id" title="var">t</span><span class="id" title="notation">)</span>) <span class="id" title="keyword">as</span> [? | [[<span class="id" title="var">s</span> <span class="id" title="var">u</span>] [<span class="id" title="var">Hr</span> <span class="id" title="var">Hn</span>]]]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="var">epose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#safety_helper"><span class="id" title="lemma">safety_helper</span></a> <span class="id" title="var">Ht</span> <a class="idref" href="Definitions.html#inert_empty"><span class="id" title="constructor">inert_empty</span></a> <a class="idref" href="PreciseTyping.html#wfe_empty"><span class="id" title="constructor">wfe_empty</span></a> <a class="idref" href="Definitions.html#well_typed_empty"><span class="id" title="constructor">well_typed_empty</span></a> <span class="id" title="var">Hr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [[<span class="id" title="var">γ'</span> [<span class="id" title="var">t'</span> [<span class="id" title="var">G'</span> [<span class="id" title="var">Hr'</span> [<span class="id" title="var">Ht'</span> <span class="id" title="var">Hwt</span>]]]]] | [<span class="id" title="var">G</span> [<span class="id" title="var">Hn'</span> [<span class="id" title="var">Ht'</span> [<span class="id" title="var">Hwt</span> [<span class="id" title="var">Hwf</span> <span class="id" title="var">Hi</span>]]]]]].<br/>
&nbsp;&nbsp;- <span class="id" title="var">false</span>× <span class="id" title="var">Hn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Safety.html#Safety"><span class="id" title="section">Safety</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab90"></a><h2 class="section">Safety wrt Path Lookup ⤳</h2>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a name="PathSafety"><span class="id" title="section">PathSafety</span></a>.<br/>

<br/>
</div>

<div class="doc">
Looking up any well-typed path in the value environment results either
<ul class="doclist">
<li> in a value in a finite number of steps, or

</li>
<li> in an infinite sequence of lookup operations, i.e. the path is cyclic 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="path_safety"><span class="id" title="lemma">path_safety</span></a> <span class="id" title="var">G</span> <span class="id" title="var">p</span> <span class="id" title="var">T</span> <span class="id" title="var">γ</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Definitions.html#inert"><span class="id" title="inductive">inert</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="PreciseTyping.html#wf"><span class="id" title="inductive">wf</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Definitions.html#3d0e0e057bcbfdd590f754a27815747e"><span class="id" title="notation">⫶</span></a> <a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#G"><span class="id" title="variable">G</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#cyclic_path"><span class="id" title="definition">cyclic_path</span></a> <a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a> <span class="id" title="notation">∨</span> <span class="id" title="notation">∃</span> <span class="id" title="var">v</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟦</span></a> <a class="idref" href="Definitions.html#defp"><span class="id" title="constructor">defp</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⤳*</span></a> <a class="idref" href="Definitions.html#defv"><span class="id" title="constructor">defv</span></a> <a class="idref" href="Safety.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="Lookup.html#ec3bbb547a98649fb30ac24026f522c9"><span class="id" title="notation">⟧</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">proof_recipe</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="ReplacementTyping.html#repl_prec_exists"><span class="id" title="lemma">repl_prec_exists</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">U</span> <span class="id" title="var">Hp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Sequences.html#infseq_or_finseq"><span class="id" title="lemma">infseq_or_finseq</span></a> (<a class="idref" href="Lookup.html#lookup_step"><span class="id" title="inductive">lookup_step</span></a> <span class="id" title="var">γ</span>) (<a class="idref" href="Definitions.html#defp"><span class="id" title="constructor">defp</span></a> <span class="id" title="var">p</span>)) <span class="id" title="keyword">as</span> [? | [<span class="id" title="var">t</span> [<span class="id" title="var">Hl</span> <span class="id" title="var">Hirr</span>]]]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="CanonicalForms.html#lookup_pres"><span class="id" title="lemma">lookup_pres</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hp</span> <span class="id" title="var">Hl</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">S</span> <span class="id" title="var">Hq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="CanonicalForms.html#typ_to_lookup3"><span class="id" title="lemma">typ_to_lookup3</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">t</span> <span class="id" title="var">Hl'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">false</span>× <span class="id" title="var">Hirr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Safety.html#PathSafety"><span class="id" title="section">PathSafety</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab91"></a><h2 class="section">Extended Safety</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="ExtendedSafety"><span class="id" title="section">ExtendedSafety</span></a>.<br/>

<br/>
</div>

<div class="doc">
Extended reduction relation (combines term reduction ⟼ and lookup ⤳) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Reserved Notation</span> &quot;t '↠' u" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="extended_red"><span class="id" title="inductive">extended_red</span></a> : <a class="idref" href="Definitions.html#sta"><span class="id" title="definition">sta</span></a> <span class="id" title="notation">×</span> <a class="idref" href="Definitions.html#trm"><span class="id" title="inductive">trm</span></a> <span class="id" title="notation">→</span> <a class="idref" href="Definitions.html#sta"><span class="id" title="definition">sta</span></a> <span class="id" title="notation">×</span> <a class="idref" href="Definitions.html#trm"><span class="id" title="inductive">trm</span></a> <span class="id" title="notation">→</span> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="er_red"><span class="id" title="constructor">er_red</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#6a0a2cd1c1d834551a7de9c07376fb83"><span class="id" title="notation">⟼</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#35871d9392fc195d2656f8da3ef0d8b5"><span class="id" title="notation">↠</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;| <a name="er_lookup"><span class="id" title="constructor">er_lookup</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">p</span> <span class="id" title="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a> <a class="idref" href="Lookup.html#8cc79fc5d6dbc3a1ff519f58bcbc908b"><span class="id" title="notation">⟦</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="Lookup.html#8cc79fc5d6dbc3a1ff519f58bcbc908b"><span class="id" title="notation">⤳</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Lookup.html#8cc79fc5d6dbc3a1ff519f58bcbc908b"><span class="id" title="notation">⟧</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <a class="idref" href="Safety.html#p"><span class="id" title="variable">p</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#35871d9392fc195d2656f8da3ef0d8b5"><span class="id" title="notation">↠</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="CanonicalForms.html#deftrm"><span class="id" title="definition">deftrm</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> <a name="35871d9392fc195d2656f8da3ef0d8b5"><span class="id" title="notation">&quot;</span></a>t ↠ u" := (<a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a> <span class="id" title="var">t</span> <span class="id" title="var">u</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Reflexive transitive closure of extended reduction 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <a name="aa4e039642baffeef8eeffaf4ec5e4df"><span class="id" title="notation">&quot;</span></a>t '↠*' u" := ((<a class="idref" href="Sequences.html#star"><span class="id" title="inductive">star</span></a> <a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a>) <span class="id" title="var">t</span> <span class="id" title="var">u</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
</div>

<div class="doc">
Divergence of extended reduction 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="diverges'"><span class="id" title="definition">diverges'</span></a> := <a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> <a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="extend_infseq"><span class="id" title="lemma">extend_infseq</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">t</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#diverges'"><span class="id" title="definition">diverges'</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#aa4e039642baffeef8eeffaf4ec5e4df"><span class="id" title="notation">↠*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#diverges'"><span class="id" title="definition">diverges'</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hinf</span> <span class="id" title="var">Hr</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hr</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHr</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hinf</span> <span class="id" title="constructor">eq_refl</span> <span class="id" title="constructor">eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="map_red_extend"><span class="id" title="lemma">map_red_extend</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">t</span> <span class="id" title="var">γ'</span> <span class="id" title="var">t'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Reduction.html#4e97cf452882dc3f98e0131fef8d7935"><span class="id" title="notation">⟼*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#aa4e039642baffeef8eeffaf4ec5e4df"><span class="id" title="notation">↠*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#390cdadc901b8ad038b859add716aae2"><span class="id" title="variable">γ'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hr</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hr</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="map_lookup_extend"><span class="id" title="lemma">map_lookup_extend</span></a> <span class="id" title="var">γ</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sequences.html#star"><span class="id" title="inductive">star</span></a> (<a class="idref" href="Lookup.html#lookup_step"><span class="id" title="inductive">lookup_step</span></a> <a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a>) <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="CanonicalForms.html#deftrm"><span class="id" title="definition">deftrm</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#aa4e039642baffeef8eeffaf4ec5e4df"><span class="id" title="notation">↠*</span></a><span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="CanonicalForms.html#deftrm"><span class="id" title="definition">deftrm</span></a> <a class="idref" href="Safety.html#t'"><span class="id" title="variable">t'</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hr</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">Hr</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="Sequences.html#star_trans"><span class="id" title="lemma">star_trans</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Sequences.html#star_one"><span class="id" title="lemma">star_one</span></a>. <span class="id" title="tactic">apply</span>× <a class="idref" href="Safety.html#er_lookup"><span class="id" title="constructor">er_lookup</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab92"></a><h4 class="section">Extended Soundness (Theorem 5.2)</h4>
 Reducing any well-typed program (i.e. term that can be typed in an empty context)
      using the extended reduction relation (that includes term reduction and path lookup)
      results either
<ul class="doclist">
<li> in a value in a finite number of steps, or

</li>
<li> in an infinite reduction sequence. 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a name="extended_safety"><span class="id" title="lemma">extended_safety</span></a> <span class="id" title="var">t</span> <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="axiom">empty</span> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">⊢</span></a> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Definitions.html#8f800003c5c18bd4e5a8078841b62512"><span class="id" title="notation">:</span></a> <a class="idref" href="Safety.html#T"><span class="id" title="variable">T</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#diverges'"><span class="id" title="definition">diverges'</span></a> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∨</span> <span class="id" title="notation">∃</span> <span class="id" title="var">γ</span> <span class="id" title="var">v</span><span class="id" title="notation">,</span> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t"><span class="id" title="variable">t</span></a><span class="id" title="notation">)</span> <a class="idref" href="Safety.html#aa4e039642baffeef8eeffaf4ec5e4df"><span class="id" title="notation">↠*</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#b0e5ed29efd576246de3282fa163293b"><span class="id" title="variable">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="Definitions.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Safety.html#v"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#safety"><span class="id" title="lemma">safety</span></a> <span class="id" title="var">Ht</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hd</span> | [<span class="id" title="var">γ</span> [<span class="id" title="var">u</span> [<span class="id" title="var">G</span> [<span class="id" title="var">Hr</span> [<span class="id" title="var">Hn</span> [<span class="id" title="var">Hu</span> [<span class="id" title="var">Hwt</span> [<span class="id" title="var">Hwf</span> <span class="id" title="var">Hi</span>]]]]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term diverges"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">Hd</span>. <span class="id" title="var">inversions</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Sequences.html#infseq_step"><span class="id" title="constructor">infseq_step</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">b</span>:=<span class="id" title="var">b</span>); <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Safety.html#er_red"><span class="id" title="constructor">er_red</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Sequences.html#infseq_coinduction_principle"><span class="id" title="lemma">infseq_coinduction_principle</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="notation">∃</span> <span class="id" title="var">γ1</span> <span class="id" title="var">t1</span><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Safety.html#st"><span class="id" title="variable">st</span></a> <span class="id" title="notation">=</span> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#93b6893d965d0ff85791b6f6272b83f6"><span class="id" title="variable">γ1</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t1"><span class="id" title="variable">t1</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∧</span> <a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> <a class="idref" href="Reduction.html#red"><span class="id" title="inductive">red</span></a> <span class="id" title="notation">(</span><a class="idref" href="Safety.html#93b6893d965d0ff85791b6f6272b83f6"><span class="id" title="variable">γ1</span></a><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#t1"><span class="id" title="variable">t1</span></a><span class="id" title="notation">)</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> [<span class="id" title="var">γ'</span> [<span class="id" title="var">t'</span> [-&gt; <span class="id" title="var">Hinf</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">inversions</span> <span class="id" title="var">Hinf</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term evaluates to normal form"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">SCase</span> "term evaluates to a path"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="Safety.html#path_safety"><span class="id" title="lemma">path_safety</span></a> <span class="id" title="var">Hi</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hu</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hd</span> | <span class="id" title="var">Hn</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">SSCase</span> "path lookup diverges"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">assert</span> (<a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> <a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a> <span class="id" title="notation">(</span><span class="id" title="var">γ</span><span class="id" title="notation">,</span> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <span class="id" title="var">p</span><span class="id" title="notation">)</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Hu</span> <span class="id" title="var">Ht</span> <span class="id" title="var">Hi</span> <span class="id" title="var">G</span> <span class="id" title="var">T</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Sequences.html#infseq_coinduction_principle"><span class="id" title="lemma">infseq_coinduction_principle</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="notation">∃</span> <span class="id" title="var">u</span><span class="id" title="notation">,</span> <a class="idref" href="Safety.html#st"><span class="id" title="variable">st</span></a> <span class="id" title="notation">=</span> <span class="id" title="notation">(</span><span class="id" title="var">γ</span><span class="id" title="notation">,</span> <a class="idref" href="CanonicalForms.html#deftrm"><span class="id" title="definition">deftrm</span></a> <a class="idref" href="Safety.html#u"><span class="id" title="variable">u</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">∧</span> <a class="idref" href="Sequences.html#infseq"><span class="id" title="inductive">infseq</span></a> (<a class="idref" href="Lookup.html#lookup_step"><span class="id" title="inductive">lookup_step</span></a> <span class="id" title="var">γ</span>) <a class="idref" href="Safety.html#u"><span class="id" title="variable">u</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> [<span class="id" title="var">du</span> [-&gt; <span class="id" title="var">Hinf</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">Hinf</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>, <span class="id" title="var">du</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>*; <span class="id" title="tactic">apply</span>× <a class="idref" href="Safety.html#er_lookup"><span class="id" title="constructor">er_lookup</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversions</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>×. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Sequences.html#star"><span class="id" title="inductive">star</span></a> <a class="idref" href="Safety.html#extended_red"><span class="id" title="inductive">extended_red</span></a> <span class="id" title="notation">(</span><span class="id" title="axiom">empty</span><span class="id" title="notation">,</span> <span class="id" title="var">t</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span><span class="id" title="var">γ</span><span class="id" title="notation">,</span> <a class="idref" href="Definitions.html#trm_path"><span class="id" title="constructor">trm_path</span></a> <span class="id" title="var">p</span><span class="id" title="notation">)</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span>× <a class="idref" href="Safety.html#map_red_extend"><span class="id" title="lemma">map_red_extend</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span>× <a class="idref" href="Safety.html#extend_infseq"><span class="id" title="lemma">extend_infseq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">SSCase</span> "path looks up to value"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v</span> <span class="id" title="var">Hv</span>]. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">γ</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Sequences.html#star_trans"><span class="id" title="lemma">star_trans</span></a>. <span class="id" title="tactic">eapply</span> <a class="idref" href="Safety.html#map_red_extend"><span class="id" title="lemma">map_red_extend</span></a>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Safety.html#map_lookup_extend"><span class="id" title="lemma">map_lookup_extend</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hv</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">SCase</span> "term evaluates to a value"%<span class="id" title="var">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">γ</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">apply</span>× <a class="idref" href="Safety.html#map_red_extend"><span class="id" title="lemma">map_red_extend</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Safety.html#ExtendedSafety"><span class="id" title="section">ExtendedSafety</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
